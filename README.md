p align="center">
    <a href="https://sylius.com" target="_blank">
        <img src="https://demo.sylius.com/assets/shop/img/logo.png" />
    </a>
</p>

<h1 align="center">Sylius Robots Plugin</h1>

<p align="center">A Sylius plugin that allows configuring different sitemaps per each channel.</p>

<svg width="300" height="233" viewBox="0 0 300 233" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M222.8 129.84a12.713 12.713 0 01-15.19 12.466 12.71 12.71 0 1115.19-12.466z" fill="#EE3457"></path><path d="M210.09 55.71a80.339 80.339 0 00-61.21 28.19 80.671 80.671 0 00-91.67-22.24l1.25-19.47h93.15L148.88 0H15.53L7.12 129.84h50.09a30.66 30.66 0 0161.31 0h60.91a30.659 30.659 0 1161.32 0h50.09c-3.25-41.5-38.41-74.13-80.75-74.13zM0 197.01h11.23v-17.5h13.35v-10.3H11.23v-7.82h13.85v-10.31H0v45.93zm43.15-45.93H31.42v45.93h11.73v-45.93zm8.34 45.93h11.23v-17.5h13.34v-10.3H62.72v-7.82h13.84v-10.31H51.49v45.93zm27.89-35.62h9.06v35.62h11.73v-35.62h9v-10.31H79.38v10.31zm51.41 8.13l-6.83-18.44h-12.73l13.72 29.23v16.7h11.73v-16.7l13.6-29.23h-12.61l-6.88 18.44zM188 151.08h-14.42V197H190c14.34 0 23.28-7.82 23.28-23a24.713 24.713 0 00-3.73-13.58 30.566 30.566 0 01-21.55-9.34zm13.57 23c0 8.38-4.23 12.6-11 12.6h-5.27v-25.29h5.33c6.77 0 10.93 4.53 10.93 12.72m18.72-15.38V197h25.52v-10.3h-14.28v-7.88h13.84v-10.3h-13.84v-7.14h14.28v-10.3h-13.63a30.685 30.685 0 01-11.89 7.65zm52.41 12.15v9.37h13.72c-1.43 4.72-5.52 7.39-11 7.39-7.76 0-12.6-6.14-12.6-13.77 0-7.39 5.16-13.35 12.54-13.35a11.282 11.282 0 0110.12 6h13.16c-2.61-9.26-12.61-16.27-23-16.27-13.35 0-24.58 9.75-24.58 23.66a24.051 24.051 0 0024.4 24.07c15.45 0 24.51-12.09 24.51-24.45v-2.61l-27.27-.04zM28.5 226.62v-1.39h-.05a4.198 4.198 0 01-3.87 1.82c-3.92 0-6.48-3-6.48-6.94 0-3.94 2.63-6.88 6.41-6.88a5.065 5.065 0 013.81 1.54v-5.41h3.87v17.26H28.5zm0-6.53a3.277 3.277 0 00-3.941-3.152 3.28 3.28 0 00.621 6.492 3.267 3.267 0 002.373-.961 3.259 3.259 0 00.947-2.379zm6.5-10.73h3.87v2.94H35v-2.94zm0 4.32h3.87v12.94H35v-12.94zm16.19 11.43a3.883 3.883 0 01-3.61 1.94 6.484 6.484 0 01-6.115-4.229 6.473 6.473 0 01-.395-2.591c0-4 2.78-7 6.51-7a4.056 4.056 0 013.59 1.64v-1.22h3.87v11.58a8.74 8.74 0 01-.7 4c-.93 1.8-3.48 3.18-6.72 3.18-3.66 0-6-2.08-6.37-4.55h4.48a2.29 2.29 0 002.27 1.26c2 0 3.15-1.28 3.15-3.64l.04-.37zm0-4.9a3.142 3.142 0 00-3.782-2.993 3.135 3.135 0 00-2.436 2.459A3.14 3.14 0 0048 223.43a3.062 3.062 0 002.298-.911 3.059 3.059 0 00.882-2.309m6.91-10.85H62v2.94h-3.91v-2.94zm0 4.32H62v12.94h-3.91v-12.94zm7.56 12.94v-10.01h-1.92v-2.93h1.92v-4.32h3.87v4.32h1.87v2.93h-1.87v10.01h-3.87zm16.8 0v-1.39a4.185 4.185 0 01-3.81 1.84c-3.83 0-6.49-3-6.49-6.93a6.631 6.631 0 016.49-6.92 4.411 4.411 0 013.81 1.83v-1.37h3.87v12.94h-3.87zm0-6.48a3.288 3.288 0 00-3.29-3.29 3.299 3.299 0 00-2.343 5.633 3.294 3.294 0 003.6.714 3.302 3.302 0 002.033-3.057zm10.69-10.78h-3.87v17.26h3.87v-17.26zM113 226.62v-1.39a4.198 4.198 0 01-3.87 1.82c-3.92 0-6.49-3-6.49-6.94 0-3.94 2.64-6.88 6.42-6.88a5.066 5.066 0 013.81 1.54v-5.41h3.87v17.26H113zm0-6.53a3.277 3.277 0 00-3.941-3.152 3.277 3.277 0 00-2.375 4.453 3.28 3.28 0 002.996 2.039 3.269 3.269 0 002.373-.961 3.267 3.267 0 00.947-2.379zm6.46-10.73h3.87v2.94h-3.87v-2.94zm0 4.32h3.87v12.94h-3.87v-12.94zm12.18 3.64c0-.75-.56-1-1.19-1-.63 0-1.12.38-1.12.86 0 .71.63 1.06 2.43 1.52 3.08.82 4.08 2.06 4.08 3.95 0 2.7-2.33 4.41-5.27 4.41-2.94 0-5-1.66-5.28-4.3h3.86a1.317 1.317 0 00.487.902 1.33 1.33 0 00.983.288c.67 0 1.35-.39 1.35-1s-.44-1.1-2.38-1.7c-3.27-1-4.13-2.29-4.13-3.8 0-2.57 2.4-4.23 5-4.23 2.81 0 4.79 1.54 5 4.09l-3.82.01zm6.91 9.3v-10.01h-1.91v-2.93h1.91v-4.32h3.88v4.32h1.87v2.93h-1.87v10.01h-3.88zm7.45-17.26h3.87v2.94H146v-2.94zm0 4.32h3.87v12.94H146v-12.94zm10.64-4.32h-3.87v17.26h3.87v-17.26zm6.68 0h-3.87v17.26h3.87v-17.26zm5.93 11.97a2.898 2.898 0 003 2.45 2.713 2.713 0 002.36-1.22h4a6.826 6.826 0 01-11.986 1.35 6.825 6.825 0 01-.419-7.023 6.828 6.828 0 016.005-3.667 6.835 6.835 0 016.393 4.387c.329.858.481 1.774.447 2.693.004.335-.027.671-.09 1l-9.71.03zm5.93-2.62a2.9 2.9 0 00-3-2.21 2.857 2.857 0 00-2.91 2.21h5.91zm6 7.91v-12.94h3.64v1.37h.05a3.188 3.188 0 013.24-1.82v3.9c-2.31 0-3.06.89-3.06 2.35v7.14h-3.87zm15.82 0v-10h-1.44v-2.93H197v-.54c0-2.15.84-4.11 5-4.11h.53V212h-.14c-1 0-1.49.25-1.49 1.33v.4h1.63v2.93h-1.63v10l-3.9-.04zm16.84 0v-1.39h-.05a4.18 4.18 0 01-3.8 1.84c-3.83 0-6.49-3-6.49-6.93a6.628 6.628 0 016.49-6.92 4.394 4.394 0 013.8 1.83h.05v-1.37h3.87v12.94h-3.87zm0-6.48a3.289 3.289 0 00-3.29-3.29 3.299 3.299 0 103.29 3.29zm15.85-1.48a3 3 0 00-2.89-1.82 3.311 3.311 0 00-2.061 5.552c.563.601 1.33.972 2.151 1.038a2.993 2.993 0 001.658-.447 2.992 2.992 0 001.142-1.283h3.94a6.998 6.998 0 01-7.534 5.022 7 7 0 01-6.186-6.612 6.802 6.802 0 014.172-6.352 6.801 6.801 0 012.618-.528 6.87 6.87 0 016.91 5.43h-3.92zm6.84 7.96v-10.01h-1.91v-2.93h1.91v-4.32h3.88v4.32h1.87v2.93h-1.87v10.01h-3.88zM250 227a6.893 6.893 0 01-6.283-4.319 6.888 6.888 0 015.065-9.331 6.891 6.891 0 018.218 6.72 6.776 6.776 0 01-2.005 4.975A6.762 6.762 0 01250 227zm3.1-6.88a3.103 3.103 0 00-2.029-2.757 3.108 3.108 0 00-3.933 4.148A3.115 3.115 0 00250 223.39a3.188 3.188 0 003.1-3.27zm6.03 6.5v-12.94h3.64v1.37h.05a3.183 3.183 0 013.24-1.82v3.9c-2.3 0-3.05.89-3.05 2.35v7.14h-3.88zm10.81 4.32l2.05-4.97-4.81-12.29h4.13l2.59 7.51h.05l2.48-7.51h4.1l-6.48 17.26h-4.11z" fill="#fff"></path></svg>

<a href="https://www.linkedin.com/company/fiftydeg/" target="_blank" rel="nooperer noreferrer"><i class="fa fa-linkedin"></i></a>

## Documentation

For a comprehensive guide on Sylius Plugins development please go to Sylius documentation,
there you will find the <a href="https://docs.sylius.com/en/latest/plugin-development-guide/index.html">Plugin Development Guide</a>, that is full of examples.

## Quickstart Installation

### Installing with Composer

```
composer require fifty-deg/sylius-robots-plugin
```

## Development

### Docker

1. Execute `cd ./.docker && ./bin/start_dev.sh`
2. Configure `/etc/hosts` adding the line `127.0.0.1    syliusplugin.local`
3. Add `FiftyDeg\SyliusRobotsPlugin\FiftyDegSyliusRobotsPlugin::class => ['all' => true],` into /config/bundles.php 
4. In /config/packages/<the-environment-you-are-using:dev|test|prod>/fifty_deg_sylius_robots.yaml insert your robots configurations, detailed per channel.
5. In case you wish to have more channels in different hostname, remember to add all the channel hostname that you need into docker-compose.yml, under `extra_hosts`, specifying also the exact port. For example `mycompany.com:127.0.0.1`


### In case you need some extra channel for testing, you could add any automatically with a Fixture
1. In /config/packages/<the-environment-you-are-using:dev|test|prod>/fiftydeg_sylius_robots_channels_suite.yaml, you can add all the channels you need automatically, with a Fixture.
2. Add the line `&& yes | php bin/console sylius:install --no-interaction --verbose --env ${APP_ENV}` in docker-compose.yml, after the line `&& yes | php bin/console sylius:install:check-requirements`, where ${APP_ENV} should be replace with the environment you are using right now, i.e. `dev|test|prod`
and the line `&& yes | php bin/console sylius:fixtures:load fiftydeg_sylius_robots_plugin_channels_suite --no-interaction` after `&& yes | php bin/console sylius:fixtures:load default --no-interaction`


### fiftydeg_sylius_robots_channels_suite.yaml Example

```
sylius_fixtures:
  suites:
    fiftydeg_sylius_robots_plugin_channels_suite:
      listeners:
        fiftydeg_sylius_robots_plugin_channels_listener: null
      fixtures:
        fiftydeg_sylius_robots_plugin_channels_fixture:
          options:
            - code: FASHION_WEB
              hostname: syliusplugin.local
            - name: DISALLOW CHECKOUT
              code: DISALLOW_CHECKOUT
              locales:
                - en_US
              currencies:
                - USD
              hostname: syliusplugindc.local
            - name: DISALLOW CHECKOUT2
              code: DISALLOW_CHECKOUT2
              locales:
                - en_US
              currencies:
                - USD
              hostname: syliusplugindc2.local
            - name: DISALLOW CHECKOUT3
              code: DISALLOW_CHECKOUT3
              locales:
                - en_US
              currencies:
                - USD
              hostname: syliusplugindc3.local
```

## Usage

### Running plugin tests

  - Run `cd .docker && ./bin/start_test.sh` in order to start docker compose in test mode
  - Wait docker to be up and running...
  - Run `cd .docker && ./bin/php_test.sh` in order to start static analysis and Behat tests

#### BDD
A suite for BDD testing is already present; it is registered in `/tests/Behat/Resources/services.yml`, you cand find the features in `/features`, the contexts in `/tests/Behat/Resources/suites.yml`, and the asscoiated PHP code in /tests/Behat/Context/Ui/Shop.
It works on two hidden divs in your project footer; one should be cached and the other one not; but you can modify the test as you wish.

Lastly, you have to add `config/packages/<environmente-where-you-are-working-in>/fiftydeg_sylius_cache_plugin.yaml`, as described before; so you can turn on and off che cache for the two divs in thw twigs specified before.


